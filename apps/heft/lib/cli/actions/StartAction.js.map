{"version":3,"file":"StartAction.js","sourceRoot":"","sources":["../../../src/cli/actions/StartAction.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAE3D,qDAA0E;AAC1E,wDAAwG;AAGxG,qDAAkD;AAElD,MAAa,WAAY,SAAQ,+BAAc;IAI7C,YAAmB,iBAAyC;QAC1D,KAAK,CACH;YACE,UAAU,EAAE,OAAO;YACnB,OAAO,EAAE,8CAA8C;YACvD,aAAa,EAAE,EAAE;SAClB,EACD,iBAAiB,CAClB,CAAC;IACJ,CAAC;IAEM,kBAAkB;QACvB,KAAK,CAAC,kBAAkB,EAAE,CAAC;QAE3B,IAAI,CAAC,wBAAwB,GAAG,uBAAU,CAAC,6BAA6B,CAAC,IAAI,CAAC,CAAC;QAE/E,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,mBAAmB,CAAC;YACzC,iBAAiB,EAAE,SAAS;YAC5B,WAAW,EAAE,yEAAyE;SACvF,CAAC,CAAC;IACL,CAAC;IAES,KAAK,CAAC,kBAAkB;QAChC,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE;YACzB,MAAM,UAAU,GAAe,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;YACtD,MAAM,iBAAiB,GAAuB,EAAE,CAAC;YACjD,MAAM,UAAU,CAAC,eAAe,CAAC,iBAAiB,CAAC,CAAC;YAEpD,MAAM,iBAAO,CAAC,iCAAiC,CAC7C,IAAI,CAAC,QAAQ,EACb,OAAO,EACP,KAAK,IAAI,EAAE,CAAC,MAAM,UAAU,CAAC,YAAY,EAAE,CAC5C,CAAC;SACH;QAED,MAAM,UAAU,GAAe,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;QACtD,MAAM,iBAAiB,mCAClB,uBAAU,CAAC,gCAAgC,CAAC,IAAI,CAAC,wBAAwB,CAAC,KAC7E,SAAS,EAAE,IAAI,EACf,SAAS,EAAE,IAAI,GAChB,CAAC;QACF,MAAM,UAAU,CAAC,eAAe,CAAC,iBAAiB,CAAC,CAAC;QACpD,MAAM,UAAU,CAAC,YAAY,EAAE,CAAC;IAClC,CAAC;IAES,KAAK,CAAC,iBAAiB;QAC/B,MAAM,IAAI,OAAO,CAAC,GAAG,EAAE;YACrB,iCAAiC;QACnC,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AAtDD,kCAsDC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { IHeftActionBaseOptions, HeftActionBase } from './HeftActionBase';\r\nimport { IBuildStageStandardParameters, BuildStage, IBuildStageOptions } from '../../stages/BuildStage';\r\nimport { CommandLineFlagParameter } from '@rushstack/ts-command-line';\r\nimport { ICleanStageOptions, CleanStage } from '../../stages/CleanStage';\r\nimport { Logging } from '../../utilities/Logging';\r\n\r\nexport class StartAction extends HeftActionBase {\r\n  private _buildStandardParameters!: IBuildStageStandardParameters;\r\n  private _cleanFlag!: CommandLineFlagParameter;\r\n\r\n  public constructor(heftActionOptions: IHeftActionBaseOptions) {\r\n    super(\r\n      {\r\n        actionName: 'start',\r\n        summary: 'Run the local server for the current project',\r\n        documentation: ''\r\n      },\r\n      heftActionOptions\r\n    );\r\n  }\r\n\r\n  public onDefineParameters(): void {\r\n    super.onDefineParameters();\r\n\r\n    this._buildStandardParameters = BuildStage.defineStageStandardParameters(this);\r\n\r\n    this._cleanFlag = this.defineFlagParameter({\r\n      parameterLongName: '--clean',\r\n      description: 'If specified, clean the package before starting the development server.'\r\n    });\r\n  }\r\n\r\n  protected async actionExecuteAsync(): Promise<void> {\r\n    if (this._cleanFlag.value) {\r\n      const cleanStage: CleanStage = this.stages.cleanStage;\r\n      const cleanStageOptions: ICleanStageOptions = {};\r\n      await cleanStage.initializeAsync(cleanStageOptions);\r\n\r\n      await Logging.runFunctionWithLoggingBoundsAsync(\r\n        this.terminal,\r\n        'Clean',\r\n        async () => await cleanStage.executeAsync()\r\n      );\r\n    }\r\n\r\n    const buildStage: BuildStage = this.stages.buildStage;\r\n    const buildStageOptions: IBuildStageOptions = {\r\n      ...BuildStage.getOptionsFromStandardParameters(this._buildStandardParameters),\r\n      watchMode: true,\r\n      serveMode: true\r\n    };\r\n    await buildStage.initializeAsync(buildStageOptions);\r\n    await buildStage.executeAsync();\r\n  }\r\n\r\n  protected async afterExecuteAsync(): Promise<void> {\r\n    await new Promise(() => {\r\n      /* start should never continue */\r\n    });\r\n  }\r\n}\r\n"]}