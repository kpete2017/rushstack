{"version":3,"file":"TerminalProviderManager.js","sourceRoot":"","sources":["../../../src/utilities/subprocess/TerminalProviderManager.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAM3D,6FAA0F;AAE1F,MAAM,8BAA8B,GAAW,yBAAyB,CAAC;AAYzE,MAAa,uBAAwB,SAAQ,uEAAkC;IAK7E,YAAmB,OAAwC;QACzD,KAAK,EAAE,CAAC;QALF,+BAA0B,GAAW,CAAC,CAAC;QAC9B,uBAAkB,GAAmC,IAAI,GAAG,EAA6B,CAAC;QAMzG,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC,aAAa,CAAC;IAC9C,CAAC;IAEM,wBAAwB,CAAC,gBAAmC;QACjE,MAAM,EAAE,GAAW,IAAI,CAAC,0BAA0B,EAAE,CAAC;QACrD,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,EAAE,EAAE,gBAAgB,CAAC,CAAC;QAElD,OAAO,EAAE,CAAC;IACZ,CAAC;IAEM,kCAAkC,CAAC,kBAA0B;QAClE,MAAM,gBAAgB,GAAsB;YAC1C,YAAY,EAAE,IAAI,CAAC,cAAc,CAAC,oBAAoB;YACtD,aAAa,EAAE,IAAI,CAAC,cAAc,CAAC,qBAAqB;YACxD,KAAK,EAAE,CAAC,IAAY,EAAE,QAAkC,EAAE,EAAE;gBAC1D,MAAM,OAAO,GAAuC;oBAClD,IAAI,EAAE,8BAA8B;oBACpC,kBAAkB;oBAClB,IAAI;oBACJ,QAAQ;iBACT,CAAC;gBACF,IAAI,CAAC,0BAA0B,CAAC,OAAO,CAAC,CAAC;YAC3C,CAAC;SACF,CAAC;QAEF,OAAO,gBAAgB,CAAC;IAC1B,CAAC;IAEM,8BAA8B,CAAC,OAA+B;QACnE,OAAO,OAAO,CAAC,IAAI,KAAK,8BAA8B,CAAC;IACzD,CAAC;IAEM,4BAA4B,CAAC,OAA+B;QACjE,IAAI,OAAO,CAAC,IAAI,KAAK,8BAA8B,EAAE;YACnD,MAAM,EAAE,kBAAkB,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAA6C,CAAC;YAC7F,MAAM,gBAAgB,GAAkC,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;YACxG,IAAI,gBAAgB,EAAE;gBACpB,gBAAgB,CAAC,KAAK,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;aACxC;iBAAM;gBACL,MAAM,IAAI,KAAK,CAAC,+BAA+B,kBAAkB,2BAA2B,CAAC,CAAC;aAC/F;SACF;IACH,CAAC;IAEM,iCAAiC,CAAC,OAA+B;QACtE,OAAO,KAAK,CAAC;IACf,CAAC;IAEM,+BAA+B,CAAC,OAA+B,IAAS,CAAC;CACjF;AAzDD,0DAyDC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { ITerminalProvider, TerminalProviderSeverity } from '@rushstack/node-core-library';\r\n\r\nimport { ISubprocessInnerConfiguration } from './SubprocessRunnerBase';\r\nimport { ISubprocessMessageBase } from './SubprocessCommunication';\r\nimport { SubprocessCommunicationManagerBase } from './SubprocessCommunicationManagerBase';\r\n\r\nconst TERMINAL_PROVIDER_MESSAGE_TYPE: string = 'terminalProviderMessage';\r\n\r\ninterface ITerminalProviderSubprocessMessage extends ISubprocessMessageBase {\r\n  terminalProviderId: number;\r\n  data: string;\r\n  severity: TerminalProviderSeverity;\r\n}\r\n\r\nexport interface ITerminalProviderManagerOptions {\r\n  configuration: ISubprocessInnerConfiguration;\r\n}\r\n\r\nexport class TerminalProviderManager extends SubprocessCommunicationManagerBase {\r\n  private _terminalProviderIdCounter: number = 0;\r\n  private readonly _terminalProviders: Map<number, ITerminalProvider> = new Map<number, ITerminalProvider>();\r\n  private readonly _configuration: ISubprocessInnerConfiguration;\r\n\r\n  public constructor(options: ITerminalProviderManagerOptions) {\r\n    super();\r\n\r\n    this._configuration = options.configuration;\r\n  }\r\n\r\n  public registerTerminalProvider(terminalProvider: ITerminalProvider): number {\r\n    const id: number = this._terminalProviderIdCounter++;\r\n    this._terminalProviders.set(id, terminalProvider);\r\n\r\n    return id;\r\n  }\r\n\r\n  public registerSubprocessTerminalProvider(terminalProviderId: number): ITerminalProvider {\r\n    const terminalProvider: ITerminalProvider = {\r\n      eolCharacter: this._configuration.terminalEolCharacter,\r\n      supportsColor: this._configuration.terminalSupportsColor,\r\n      write: (data: string, severity: TerminalProviderSeverity) => {\r\n        const message: ITerminalProviderSubprocessMessage = {\r\n          type: TERMINAL_PROVIDER_MESSAGE_TYPE,\r\n          terminalProviderId,\r\n          data,\r\n          severity\r\n        };\r\n        this.sendMessageToParentProcess(message);\r\n      }\r\n    };\r\n\r\n    return terminalProvider;\r\n  }\r\n\r\n  public canHandleMessageFromSubprocess(message: ISubprocessMessageBase): boolean {\r\n    return message.type === TERMINAL_PROVIDER_MESSAGE_TYPE;\r\n  }\r\n\r\n  public receiveMessageFromSubprocess(message: ISubprocessMessageBase): void {\r\n    if (message.type === TERMINAL_PROVIDER_MESSAGE_TYPE) {\r\n      const { terminalProviderId, data, severity } = message as ITerminalProviderSubprocessMessage;\r\n      const terminalProvider: ITerminalProvider | undefined = this._terminalProviders.get(terminalProviderId);\r\n      if (terminalProvider) {\r\n        terminalProvider.write(data, severity);\r\n      } else {\r\n        throw new Error(`A terminal provider with ID ${terminalProviderId} has not been registered.`);\r\n      }\r\n    }\r\n  }\r\n\r\n  public canHandleMessageFromParentProcess(message: ISubprocessMessageBase): boolean {\r\n    return false;\r\n  }\r\n\r\n  public receiveMessageFromParentProcess(message: ISubprocessMessageBase): void {}\r\n}\r\n"]}