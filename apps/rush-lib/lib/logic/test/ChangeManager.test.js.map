{"version":3,"file":"ChangeManager.test.js","sourceRoot":"","sources":["../../../src/logic/test/ChangeManager.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport * as path from 'path';\r\n\r\nimport { RushConfiguration } from '../../api/RushConfiguration';\r\nimport { ChangeManager } from '../ChangeManager';\r\nimport { PrereleaseToken } from '../PrereleaseToken';\r\n\r\ndescribe('ChangeManager', () => {\r\n  const rushJsonFile: string = path.resolve(__dirname, 'packages', 'rush.json');\r\n  let rushConfiguration: RushConfiguration;\r\n  let changeManager: ChangeManager;\r\n\r\n  beforeEach(() => {\r\n    rushConfiguration = RushConfiguration.loadFromConfigurationFile(rushJsonFile);\r\n    changeManager = new ChangeManager(rushConfiguration);\r\n  });\r\n\r\n  /* eslint-disable dot-notation */\r\n  it('can apply changes to the package.json files in the dictionary', () => {\r\n    changeManager.load(path.join(__dirname, 'multipleChanges'));\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('2.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.1');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual('>=2.0.0 <3.0.0');\r\n    expect(changeManager.allPackages.get('e')!.packageJson.devDependencies!['a']).toEqual('>=2.0.0 <3.0.0');\r\n    expect(changeManager.allPackages.get('e')!.packageJson.peerDependencies!['a']).toEqual('>=2.0.0 <3.0.0');\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('c')!.packageJson.dependencies!['b']).toEqual('>=1.0.1 <2.0.0');\r\n    expect(changeManager.allPackages.get('f')!.packageJson.devDependencies!['b']).toEqual('>=1.0.1 <2.0.0');\r\n    expect(changeManager.allPackages.get('f')!.packageJson.peerDependencies!['b']).toEqual('>=1.0.1 <2.0.0');\r\n  });\r\n\r\n  it('can update explicit version dependency', () => {\r\n    changeManager.load(path.join(__dirname, 'explicitVersionChange'));\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.1');\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.1');\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual('1.0.1');\r\n  });\r\n\r\n  it('can update explicit cyclic dependency', () => {\r\n    changeManager.load(path.join(__dirname, 'cyclicDepsExplicit'));\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('cyclic-dep-explicit-1')!.packageJson.version).toEqual('2.0.0');\r\n    expect(\r\n      changeManager.allPackages.get('cyclic-dep-explicit-1')!.packageJson.dependencies![\r\n        'cyclic-dep-explicit-2'\r\n      ]\r\n    ).toEqual('>=1.0.0 <2.0.0');\r\n    expect(changeManager.allPackages.get('cyclic-dep-explicit-2')!.packageJson.version).toEqual('1.0.0');\r\n    expect(\r\n      changeManager.allPackages.get('cyclic-dep-explicit-2')!.packageJson.dependencies![\r\n        'cyclic-dep-explicit-1'\r\n      ]\r\n    ).toEqual('>=1.0.0 <2.0.0');\r\n  });\r\n\r\n  it('can update root with patch change for prerelease', () => {\r\n    const prereleaseName: string = 'alpha.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(prereleaseName);\r\n\r\n    changeManager.load(path.join(__dirname, 'rootPatchChange'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual(\r\n      '1.0.1-' + prereleaseName\r\n    );\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual(\r\n      '1.0.1-' + prereleaseName\r\n    );\r\n  });\r\n\r\n  it('can update non-root with patch change for prerelease', () => {\r\n    const prereleaseName: string = 'beta.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(prereleaseName);\r\n\r\n    changeManager.load(path.join(__dirname, 'explicitVersionChange'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual('>=1.0.0 <2.0.0');\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual(\r\n      '1.0.1-' + prereleaseName\r\n    );\r\n  });\r\n\r\n  it('can update cyclic dependency for non-explicit prerelease', () => {\r\n    const prereleaseName: string = 'beta.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(prereleaseName);\r\n\r\n    changeManager.load(path.join(__dirname, 'cyclicDeps'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('cyclic-dep-1')!.packageJson.version).toEqual(\r\n      '2.0.0-' + prereleaseName\r\n    );\r\n    expect(changeManager.allPackages.get('cyclic-dep-1')!.packageJson.dependencies!['cyclic-dep-2']).toEqual(\r\n      '1.0.1-' + prereleaseName\r\n    );\r\n    expect(changeManager.allPackages.get('cyclic-dep-2')!.packageJson.version).toEqual(\r\n      '1.0.1-' + prereleaseName\r\n    );\r\n    expect(changeManager.allPackages.get('cyclic-dep-2')!.packageJson.dependencies!['cyclic-dep-1']).toEqual(\r\n      '2.0.0-' + prereleaseName\r\n    );\r\n  });\r\n\r\n  it('can update root with patch change for adding version suffix', () => {\r\n    const suffix: string = 'dk.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(undefined, suffix);\r\n\r\n    changeManager.load(path.join(__dirname, 'rootPatchChange'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual('1.0.0-' + suffix);\r\n  });\r\n\r\n  it('can update non-root with patch change for version suffix', () => {\r\n    const suffix: string = 'dk.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(undefined, suffix);\r\n\r\n    changeManager.load(path.join(__dirname, 'explicitVersionChange'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual('>=1.0.0 <2.0.0');\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual('1.0.0-' + suffix);\r\n  });\r\n\r\n  it('can update cyclic dependency for non-explicit suffix', () => {\r\n    const suffix: string = 'dk.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(undefined, suffix);\r\n\r\n    changeManager.load(path.join(__dirname, 'cyclicDeps'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('cyclic-dep-1')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('cyclic-dep-1')!.packageJson.dependencies!['cyclic-dep-2']).toEqual(\r\n      '1.0.0-' + suffix\r\n    );\r\n    expect(changeManager.allPackages.get('cyclic-dep-2')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('cyclic-dep-2')!.packageJson.dependencies!['cyclic-dep-1']).toEqual(\r\n      '1.0.0-' + suffix\r\n    );\r\n  });\r\n  /* eslint-enable dot-notation */\r\n});\r\n\r\ndescribe('WorkspaceChangeManager', () => {\r\n  const rushJsonFile: string = path.resolve(__dirname, 'workspacePackages', 'rush.json');\r\n  let rushConfiguration: RushConfiguration;\r\n  let changeManager: ChangeManager;\r\n\r\n  beforeEach(() => {\r\n    rushConfiguration = RushConfiguration.loadFromConfigurationFile(rushJsonFile);\r\n    changeManager = new ChangeManager(rushConfiguration);\r\n  });\r\n\r\n  /* eslint-disable dot-notation */\r\n  it('can apply changes to the package.json files in the dictionary', () => {\r\n    changeManager.load(path.join(__dirname, 'multipleChanges'));\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('2.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.1');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual(\r\n      'workspace:>=2.0.0 <3.0.0'\r\n    );\r\n    expect(changeManager.allPackages.get('e')!.packageJson.devDependencies!['a']).toEqual(\r\n      'workspace:>=2.0.0 <3.0.0'\r\n    );\r\n    expect(changeManager.allPackages.get('e')!.packageJson.peerDependencies!['a']).toEqual('>=2.0.0 <3.0.0');\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('c')!.packageJson.dependencies!['b']).toEqual(\r\n      'workspace:>=1.0.1 <2.0.0'\r\n    );\r\n    expect(changeManager.allPackages.get('f')!.packageJson.devDependencies!['b']).toEqual(\r\n      'workspace:>=1.0.1 <2.0.0'\r\n    );\r\n    expect(changeManager.allPackages.get('f')!.packageJson.peerDependencies!['b']).toEqual('>=1.0.1 <2.0.0');\r\n  });\r\n\r\n  it('can update explicit version dependency', () => {\r\n    changeManager.load(path.join(__dirname, 'explicitVersionChange'));\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.1');\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.1');\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual('workspace:1.0.1');\r\n  });\r\n\r\n  it('can update explicit cyclic dependency', () => {\r\n    changeManager.load(path.join(__dirname, 'cyclicDepsExplicit'));\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('cyclic-dep-explicit-1')!.packageJson.version).toEqual('2.0.0');\r\n    expect(\r\n      changeManager.allPackages.get('cyclic-dep-explicit-1')!.packageJson.dependencies![\r\n        'cyclic-dep-explicit-2'\r\n      ]\r\n    ).toEqual('workspace:>=1.0.0 <2.0.0');\r\n    expect(changeManager.allPackages.get('cyclic-dep-explicit-2')!.packageJson.version).toEqual('1.0.0');\r\n    expect(\r\n      changeManager.allPackages.get('cyclic-dep-explicit-2')!.packageJson.dependencies![\r\n        'cyclic-dep-explicit-1'\r\n      ]\r\n    ).toEqual('>=1.0.0 <2.0.0');\r\n  });\r\n\r\n  it('can update root with patch change for prerelease', () => {\r\n    const prereleaseName: string = 'alpha.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(prereleaseName);\r\n\r\n    changeManager.load(path.join(__dirname, 'rootPatchChange'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual(\r\n      'workspace:1.0.1-' + prereleaseName\r\n    );\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual(\r\n      'workspace:1.0.1-' + prereleaseName\r\n    );\r\n  });\r\n\r\n  it('can update non-root with patch change for prerelease', () => {\r\n    const prereleaseName: string = 'beta.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(prereleaseName);\r\n\r\n    changeManager.load(path.join(__dirname, 'explicitVersionChange'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual(\r\n      'workspace:>=1.0.0 <2.0.0'\r\n    );\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.1-' + prereleaseName);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual(\r\n      'workspace:1.0.1-' + prereleaseName\r\n    );\r\n  });\r\n\r\n  it('can update cyclic dependency for non-explicit prerelease', () => {\r\n    const prereleaseName: string = 'beta.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(prereleaseName);\r\n\r\n    changeManager.load(path.join(__dirname, 'cyclicDeps'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('cyclic-dep-1')!.packageJson.version).toEqual(\r\n      '2.0.0-' + prereleaseName\r\n    );\r\n    expect(changeManager.allPackages.get('cyclic-dep-1')!.packageJson.dependencies!['cyclic-dep-2']).toEqual(\r\n      'workspace:1.0.1-' + prereleaseName\r\n    );\r\n    expect(changeManager.allPackages.get('cyclic-dep-2')!.packageJson.version).toEqual(\r\n      '1.0.1-' + prereleaseName\r\n    );\r\n    expect(changeManager.allPackages.get('cyclic-dep-2')!.packageJson.dependencies!['cyclic-dep-1']).toEqual(\r\n      'workspace:2.0.0-' + prereleaseName\r\n    );\r\n  });\r\n\r\n  it('can update root with patch change for adding version suffix', () => {\r\n    const suffix: string = 'dk.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(undefined, suffix);\r\n\r\n    changeManager.load(path.join(__dirname, 'rootPatchChange'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual(\r\n      'workspace:1.0.0-' + suffix\r\n    );\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual(\r\n      'workspace:1.0.0-' + suffix\r\n    );\r\n  });\r\n\r\n  it('can update non-root with patch change for version suffix', () => {\r\n    const suffix: string = 'dk.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(undefined, suffix);\r\n\r\n    changeManager.load(path.join(__dirname, 'explicitVersionChange'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('a')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.version).toEqual('1.0.0');\r\n    expect(changeManager.allPackages.get('b')!.packageJson.dependencies!['a']).toEqual(\r\n      'workspace:>=1.0.0 <2.0.0'\r\n    );\r\n    expect(changeManager.allPackages.get('c')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('d')!.packageJson.dependencies!['c']).toEqual(\r\n      'workspace:1.0.0-' + suffix\r\n    );\r\n  });\r\n\r\n  it('can update cyclic dependency for non-explicit suffix', () => {\r\n    const suffix: string = 'dk.1';\r\n    const prereleaseToken: PrereleaseToken = new PrereleaseToken(undefined, suffix);\r\n\r\n    changeManager.load(path.join(__dirname, 'cyclicDeps'), prereleaseToken);\r\n    changeManager.apply(false);\r\n\r\n    expect(changeManager.allPackages.get('cyclic-dep-1')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('cyclic-dep-1')!.packageJson.dependencies!['cyclic-dep-2']).toEqual(\r\n      'workspace:1.0.0-' + suffix\r\n    );\r\n    expect(changeManager.allPackages.get('cyclic-dep-2')!.packageJson.version).toEqual('1.0.0-' + suffix);\r\n    expect(changeManager.allPackages.get('cyclic-dep-2')!.packageJson.dependencies!['cyclic-dep-1']).toEqual(\r\n      'workspace:1.0.0-' + suffix\r\n    );\r\n  });\r\n  /* eslint-enable dot-notation */\r\n});\r\n"]}