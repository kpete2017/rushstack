{"version":3,"file":"RehydrateAsset.test.js","sourceRoot":"","sources":["../../src/test/RehydrateAsset.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { RawSource } from 'webpack-sources';\r\nimport { rehydrateAsset } from '../RehydrateAsset';\r\nimport { CHUNK_MODULES_TOKEN } from '../Constants';\r\nimport { IAssetInfo, IModuleMap } from '../ModuleMinifierPlugin.types';\r\n\r\nconst modules: IModuleMap = new Map();\r\nmodules.set('a', {\r\n  source: new RawSource('foo'),\r\n  extractedComments: [],\r\n  module: undefined!\r\n});\r\nmodules.set('b', {\r\n  source: new RawSource('bar'),\r\n  extractedComments: [],\r\n  module: undefined!\r\n});\r\nmodules.set('0b', {\r\n  source: new RawSource('baz'),\r\n  extractedComments: [],\r\n  module: undefined!\r\n});\r\nmodules.set('=', {\r\n  source: new RawSource('bak'),\r\n  extractedComments: [],\r\n  module: undefined!\r\n});\r\nmodules.set('a0', {\r\n  source: new RawSource('bal'),\r\n  extractedComments: [],\r\n  module: undefined!\r\n});\r\nmodules.set(0, {\r\n  source: new RawSource('fizz'),\r\n  extractedComments: [],\r\n  module: undefined!\r\n});\r\nmodules.set(2, {\r\n  source: new RawSource('buzz'),\r\n  extractedComments: [],\r\n  module: undefined!\r\n});\r\nmodules.set(255, {\r\n  source: new RawSource('__WEBPACK_EXTERNAL_MODULE_fizz__'),\r\n  extractedComments: [],\r\n  module: undefined!\r\n});\r\nfor (let i: number = 14; i < 30; i++) {\r\n  if (i !== 25) {\r\n    modules.set(i, {\r\n      source: new RawSource('bozz'),\r\n      extractedComments: [],\r\n      module: undefined!\r\n    });\r\n  }\r\n}\r\nmodules.set(25, {\r\n  source: new RawSource('bang'),\r\n  extractedComments: [],\r\n  module: undefined!\r\n});\r\nfor (let i: number = 1000; i < 1010; i++) {\r\n  modules.set(i, {\r\n    source: new RawSource(`b${i}`),\r\n    extractedComments: [],\r\n    module: undefined!\r\n  });\r\n}\r\n\r\nconst banner: string = `/* fnord */\\n`;\r\n\r\ndescribe('rehydrateAsset', () => {\r\n  it('uses an object for non-numeric ids', () => {\r\n    const asset: IAssetInfo = {\r\n      source: new RawSource(`<before>${CHUNK_MODULES_TOKEN}<after>`),\r\n      modules: ['a', 'b', '0b', '=', 'a0'],\r\n      extractedComments: [],\r\n      fileName: 'test',\r\n      chunk: undefined!,\r\n      externalNames: new Map()\r\n    };\r\n\r\n    const result: string = rehydrateAsset(asset, modules, banner).source() as string;\r\n    const expected: string = `/* fnord */\\n<before>{a:foo,b:bar,\"0b\":baz,\"=\":bak,a0:bal}<after>`;\r\n\r\n    if (result !== expected) {\r\n      throw new Error(`Expected ${expected} but received ${result}`);\r\n    }\r\n  });\r\n\r\n  it('uses an object for widely separated ids', () => {\r\n    const asset: IAssetInfo = {\r\n      source: new RawSource(`<before>${CHUNK_MODULES_TOKEN}<after>`),\r\n      modules: [0, 25],\r\n      extractedComments: [],\r\n      fileName: 'test',\r\n      chunk: undefined!,\r\n      externalNames: new Map()\r\n    };\r\n\r\n    const result: string = rehydrateAsset(asset, modules, banner).source() as string;\r\n    const expected: string = `/* fnord */\\n<before>{0:fizz,25:bang}<after>`;\r\n\r\n    if (result !== expected) {\r\n      throw new Error(`Expected ${expected} but received ${result}`);\r\n    }\r\n  });\r\n\r\n  it('uses a regular array for a couple missing leading elements', () => {\r\n    const asset: IAssetInfo = {\r\n      source: new RawSource(`<before>${CHUNK_MODULES_TOKEN}<after>`),\r\n      modules: [2],\r\n      extractedComments: [],\r\n      fileName: 'test',\r\n      chunk: undefined!,\r\n      externalNames: new Map()\r\n    };\r\n\r\n    const result: string = rehydrateAsset(asset, modules, banner).source() as string;\r\n    const expected: string = `/* fnord */\\n<before>[,,buzz]<after>`;\r\n\r\n    if (result !== expected) {\r\n      throw new Error(`Expected ${expected} but received ${result}`);\r\n    }\r\n  });\r\n\r\n  it('uses a regular array for several missing leading elements', () => {\r\n    const asset: IAssetInfo = {\r\n      source: new RawSource(`<before>${CHUNK_MODULES_TOKEN}<after>`),\r\n      modules: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29],\r\n      extractedComments: [],\r\n      fileName: 'test',\r\n      chunk: undefined!,\r\n      externalNames: new Map()\r\n    };\r\n\r\n    const result: string = rehydrateAsset(asset, modules, banner).source() as string;\r\n    const expected: string = `/* fnord */\\n<before>[,,,,,,,,,,,,,,bozz,bozz,bozz,bozz,bozz,bozz,bozz,bozz,bozz,bozz,bozz,bang,bozz,bozz,bozz,bozz]<after>`;\r\n\r\n    if (result !== expected) {\r\n      throw new Error(`Expected ${expected} but received ${result}`);\r\n    }\r\n  });\r\n\r\n  it('uses a concat array for a tight cluster of ids', () => {\r\n    const asset: IAssetInfo = {\r\n      source: new RawSource(`<before>${CHUNK_MODULES_TOKEN}<after>`),\r\n      modules: [1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009],\r\n      extractedComments: [],\r\n      fileName: 'test',\r\n      chunk: undefined!,\r\n      externalNames: new Map()\r\n    };\r\n\r\n    const result: string = rehydrateAsset(asset, modules, banner).source() as string;\r\n    const expected: string = `/* fnord */\\n<before>Array(1000).concat([b1000,b1001,b1002,b1003,b1004,b1005,b1006,b1007,b1008,b1009])<after>`;\r\n\r\n    if (result !== expected) {\r\n      throw new Error(`Expected ${expected} but received ${result}`);\r\n    }\r\n  });\r\n\r\n  it('uses a concat spacer for multiple tight clusters of ids', () => {\r\n    const asset: IAssetInfo = {\r\n      source: new RawSource(`<before>${CHUNK_MODULES_TOKEN}<after>`),\r\n      modules: [0, 2, 1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009],\r\n      extractedComments: [],\r\n      fileName: 'test',\r\n      chunk: undefined!,\r\n      externalNames: new Map()\r\n    };\r\n\r\n    const result: string = rehydrateAsset(asset, modules, banner).source() as string;\r\n    const expected: string = `/* fnord */\\n<before>[fizz,,buzz].concat(Array(997),[b1000,b1001,b1002,b1003,b1004,b1005,b1006,b1007,b1008,b1009])<after>`;\r\n\r\n    if (result !== expected) {\r\n      throw new Error(`Expected ${expected} but received ${result}`);\r\n    }\r\n  });\r\n\r\n  it('supports a concat spacer and leading ids', () => {\r\n    const asset: IAssetInfo = {\r\n      source: new RawSource(`<before>${CHUNK_MODULES_TOKEN}<after>`),\r\n      modules: [2, 1000, 1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009],\r\n      extractedComments: [],\r\n      fileName: 'test',\r\n      chunk: undefined!,\r\n      externalNames: new Map()\r\n    };\r\n\r\n    const result: string = rehydrateAsset(asset, modules, banner).source() as string;\r\n    const expected: string = `/* fnord */\\n<before>[,,buzz].concat(Array(997),[b1000,b1001,b1002,b1003,b1004,b1005,b1006,b1007,b1008,b1009])<after>`;\r\n\r\n    if (result !== expected) {\r\n      throw new Error(`Expected ${expected} but received ${result}`);\r\n    }\r\n  });\r\n\r\n  it('reprocesses external names', () => {\r\n    const asset: IAssetInfo = {\r\n      source: new RawSource(`<before>${CHUNK_MODULES_TOKEN}<after>`),\r\n      modules: [255],\r\n      extractedComments: [],\r\n      fileName: 'test',\r\n      chunk: undefined!,\r\n      externalNames: new Map([['__WEBPACK_EXTERNAL_MODULE_fizz__', 'TREBLE']])\r\n    };\r\n\r\n    const result: string = rehydrateAsset(asset, modules, banner).source() as string;\r\n    const expected: string = `/* fnord */\\n<before>{255:TREBLE}<after>`;\r\n\r\n    if (result !== expected) {\r\n      throw new Error(`Expected ${expected} but received ${result}`);\r\n    }\r\n  });\r\n});\r\n"]}